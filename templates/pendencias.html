{% extends "base.html" %}
{% block content %}
<div class="grid">
  <div class="card col-12">
    <h3>Nova pendência</h3>
    <form class="form" method="post" action="{{ url_for('pendencias_create') }}">
      <input class="input col-6" name="title" placeholder="Descrição (ex: Luz, parcela empréstimo...)" required>
      <input class="input col-3" name="due_date" type="date" required>
      <input class="input col-3" name="amount" type="number" step="0.01" placeholder="Valor" required>

      <select class="input col-4" name="kind" required>
        <option value="PAGAR">A pagar</option>
        <option value="RECEBER">A receber</option>
        <option value="EMPRESTIMO">Empréstimo/Financiamento</option>
      </select>

      <select class="input col-4" name="creditor_id">
        <option value="">(Opcional) Credor</option>
        {% for c in credores %}
          <option value="{{ c.id }}">{{ c.name }}</option>
        {% endfor %}
      </select>

      <select class="input col-4" name="account_id" required>
        {% for a in contas %}
          <option value="{{ a.id }}">{{ a.name }}</option>
        {% endfor %}
      </select>

      <div class="col-12 split">
        <button class="btn" type="submit">Criar pendência</button>
      </div>
    </form>
  </div>

  <div class="card col-12">
    <h3>Pendências (lista geral)</h3>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th><th>Tipo</th><th>Descrição</th><th>Conta</th><th>Credor</th>
          <th>Vencimento</th><th>Valor</th><th>Status</th><th>Ação</th>
        </tr>
      </thead>
      <tbody>
        {% for p in pendencias %}
        <tr>
          <td>{{ p.uid }}</td>
          <td><span class="badge gold">{{ p.kind }}</span></td>
          <td>{{ p.title }}</td>
          <td>{{ p.account.name }}</td>
          <td>{{ p.creditor.name if p.creditor else "-" }}</td>
          <td>{{ p.due_date }}</td>
          <td>R$ {{ "%.2f"|format(p.amount) }}</td>
          <td>{{ p.status }}</td>
          <td>
            {% if p.status != "PAGO" %}
              <form method="post" action="{{ url_for('pendencias_pay', pending_id=p.id) }}" style="display:flex;gap:8px;align-items:center;">
                <input class="input" name="paid_amount" type="number" step="0.01" placeholder="Quanto pagou?" required style="width:150px;">
                <button class="btn" type="submit">Marcar pago</button>
              </form>
            {% else %}
              <small>Concluído</small>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
        {% if not pendencias %}
          <tr><td colspan="9"><small>Nenhuma pendência criada ainda.</small></td></tr>
        {% endif %}
      </tbody>
    </table>
    <p style="margin-top:10px;"><small>Ao pagar, o sistema pergunta o valor pago e calcula diferença (juros/desconto) automaticamente.</small></p>
  </div>
</div>
{% endblock %}
